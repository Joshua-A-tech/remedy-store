<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <title>Place Your Order - Remedy Store</title>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Shopping Cart Functionality
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      function addToCart(productName, price) {
        const existingItem = cart.find(item => item.name === productName);
        
        if (existingItem) {
          existingItem.quantity++;
        } else {
          cart.push({ name: productName, price: price, quantity: 1 });
        }
        
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        showAddToCartNotification(productName);
      }

      function updateCartUI() {
        const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        document.getElementById('cart-count').textContent = cartCount;
        document.getElementById('cart-total').textContent = 'KES ' + cartTotal.toLocaleString();
      }

      function showAddToCartNotification(productName) {
        const notification = document.createElement('div');
        notification.className = 'alert alert-success alert-dismissible fade show';
        notification.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
          <strong>‚úì Added to Cart!</strong> ${productName} has been added to your shopping cart.
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.remove(), 3000);
      }

      function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        const alertClass = type === 'success' ? 'alert-success' : type === 'danger' ? 'alert-danger' : 'alert-info';
        toast.className = `alert ${alertClass} alert-dismissible fade show`;
        toast.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 320px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
        toast.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 150);
        }, 4000);
      }

      function removeFromCart(index) {
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        displayCartItems();
      }

      function displayCartItems() {
        const cartItemsDiv = document.getElementById('cart-items');
        if (cart.length === 0) {
          cartItemsDiv.innerHTML = '<p class="text-muted">Your cart is empty</p>';
          return;
        }

        cartItemsDiv.innerHTML = cart.map((item, index) => `
          <div class="card mb-2">
            <div class="card-body p-3">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="mb-1">${item.name}</h6>
                  <p class="mb-0"><small class="text-muted">KES ${item.price} √ó ${item.quantity} = KES ${(item.price * item.quantity).toLocaleString()}</small></p>
                </div>
                <div class="col-auto">
                  <button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})">Remove</button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }

      // Initialize cart on page load
      window.addEventListener('load', () => {
        updateCartUI();
        displayCartItems();
      });

      // Checkout Functionality
      function openCheckout() {
        if (cart.length === 0) {
          alert('Your cart is empty! Please add items before checkout.');
          return;
        }
        displayCheckoutSummary();
        const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));
        checkoutModal.show();
      }

      function displayCheckoutSummary() {
        const summaryDiv = document.getElementById('checkout-summary');
        const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const shippingFee = 50;
        const tax = Math.round(cartTotal * 0.005);
        const grandTotal = cartTotal + shippingFee + tax;

        summaryDiv.innerHTML = `
          <div class="card mb-3">
            <div class="card-header bg-light">
              <h6 class="mb-0">Order Summary</h6>
            </div>
            <div class="card-body">
              ${cart.map(item => `
                <div class="d-flex justify-content-between mb-2">
                  <span>${item.name} √ó ${item.quantity}</span>
                  <span>KES ${(item.price * item.quantity).toLocaleString()}</span>
                </div>
              `).join('')}
              <hr>
              <div class="d-flex justify-content-between mb-2">
                <span>Subtotal:</span>
                <span>KES ${cartTotal.toLocaleString()}</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Shipping:</span>
                <span>KES ${shippingFee.toLocaleString()}</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span>Tax (0.5%):</span>
                <span>KES ${tax.toLocaleString()}</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between fs-5">
                <strong>Grand Total:</strong>
                <strong class="text-success">KES ${grandTotal.toLocaleString()}</strong>
              </div>
            </div>
          </div>
        `;
      }

      function placeOrder(event) {
        // Prevent default if called as form submit
        if (event) {
          event.preventDefault();
        }

        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const address = document.getElementById('address').value.trim();
        const city = document.getElementById('city').value.trim();
        
        // Get selected payment method from radio buttons
        const paymentMethodElement = document.querySelector('input[name="paymentMethod"]:checked');
        const paymentMethod = paymentMethodElement ? paymentMethodElement.value : '';

        // Validation
        if (!fullName) {
          alert('Please enter your full name!');
          document.getElementById('fullName').focus();
          return false;
        }
        if (!email || !email.includes('@')) {
          alert('Please enter a valid email address!');
          document.getElementById('email').focus();
          return false;
        }
        if (!phone || phone.length < 10) {
          alert('Please enter a valid phone number (at least 10 digits)!');
          document.getElementById('phone').focus();
          return false;
        }
        if (!address) {
          alert('Please enter your street address!');
          document.getElementById('address').focus();
          return false;
        }
        if (!city) {
          alert('Please enter your city!');
          document.getElementById('city').focus();
          return false;
        }
        if (!paymentMethod) {
          alert('Please select a payment method!');
          return false;
        }

        if (cart.length === 0) {
          alert('Your cart is empty! Please add items before placing an order.');
          return false;
        }

        // If M-Pesa is selected, show M-Pesa payment prompt
        if (paymentMethod === 'M-Pesa') {
          showMpesaPayment(fullName, email, phone, address, city);
          return false;
        }

        // For other payment methods, proceed normally
        completeOrder(fullName, email, phone, address, city, paymentMethod);
        return false;
      }

      function showMpesaPayment(fullName, email, phone, address, city) {
        // Show M-Pesa payment modal
        const mpesaModal = new bootstrap.Modal(document.getElementById('mpesaPaymentModal'));
        document.getElementById('mpesaPhoneInput').value = phone;
        document.getElementById('mpesaPhoneInput').focus();
        mpesaModal.show();
        
        // Store order details for processing
        window.pendingOrderData = {
          fullName, email, phone, address, city,
          paymentMethod: 'M-Pesa'
        };
      }

      function processM2UPayment() {
        const mpesaPhone = document.getElementById('mpesaPhoneInput').value.trim();

        // Validate phone
        if (!mpesaPhone) {
          showToast('Please enter a phone number!', 'danger');
          document.getElementById('mpesaPhoneInput').focus();
          return false;
        }

        // Validate phone format - must be 10-12 digits
        const phoneRegex = /^[0-9]{10,12}$/;
        if (!phoneRegex.test(mpesaPhone.replace(/\D/g, ''))) {
          showToast('Please enter a valid M-Pesa phone number (10-12 digits)!', 'danger');
          document.getElementById('mpesaPhoneInput').focus();
          return false;
        }

        // Disable button
        const payBtn = document.querySelector('#mpesaPaymentModal .btn-success');
        payBtn.disabled = true;
        const originalText = payBtn.innerHTML;
        payBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Sending STK...';

        // Get order data
        const { fullName, email, phone, address, city, paymentMethod } = window.pendingOrderData;
        const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const shippingFee = 50;
        const tax = Math.round(cartTotal * 0.005);
        const grandTotal = cartTotal + shippingFee + tax;

        // Show toast notification
        showToast('üì≤ Sending M-Pesa STK prompt to ' + mpesaPhone + '...', 'info');

        // Send to backend API
        fetch('/api/mpesa-stk-push', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            phoneNumber: mpesaPhone,
            amount: grandTotal,
            orderNumber: 'ORD-' + Date.now(),
            customerName: fullName
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showToast('‚úÖ STK prompt sent! Check your phone and enter your PIN', 'success');

            // Store checkout request ID for status checking
            window.checkoutRequestId = data.checkoutRequestId;
            window.orderAmount = grandTotal;

            // Start polling for payment status
            setTimeout(() => {
              pollPaymentStatus(data.checkoutRequestId, fullName, email, phone, address, city, paymentMethod, mpesaPhone);
            }, 3000);

            // Close modal after brief delay
            setTimeout(() => {
              const modal = bootstrap.Modal.getInstance(document.getElementById('mpesaPaymentModal'));
              if (modal) {
                modal.hide();
              }
              payBtn.disabled = false;
              payBtn.innerHTML = originalText;
            }, 2000);
          } else {
            showToast('‚ùå ' + (data.message || 'Failed to send STK'), 'danger');
            payBtn.disabled = false;
            payBtn.innerHTML = originalText;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showToast('‚ùå Network error. Please check your connection and try again.', 'danger');
          payBtn.disabled = false;
          payBtn.innerHTML = originalText;
        });

        return false;
      }

      function pollPaymentStatus(checkoutRequestId, fullName, email, phone, address, city, paymentMethod, mpesaPhone) {
        let pollCount = 0;
        const maxPolls = 60; // Poll for up to 60 seconds (1 minute)

        const pollInterval = setInterval(() => {
          pollCount++;

          fetch('/api/check-payment-status', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              checkoutRequestId: checkoutRequestId
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              if (data.status === 'COMPLETED') {
                // Payment successful
                clearInterval(pollInterval);
                showToast('üíö Payment successful! Processing your order...', 'success');
                completeOrder(fullName, email, phone, address, city, paymentMethod, mpesaPhone);
              } else if (data.status === 'FAILED') {
                // Payment failed
                clearInterval(pollInterval);
                showToast('‚ùå Payment was cancelled or failed. Please try again.', 'danger');
              }
            }

            // Stop polling after max attempts
            if (pollCount >= maxPolls) {
              clearInterval(pollInterval);
              showToast('‚è±Ô∏è Payment check timeout. Please verify your payment on M-Pesa and refresh the page.', 'warning');
            }
          })
          .catch(error => {
            console.error('Poll error:', error);
            if (pollCount >= maxPolls) {
              clearInterval(pollInterval);
            }
          });
        }, 2000); // Poll every 2 seconds
      }

      function completeOrder(fullName, email, phone, address, city, paymentMethod, mpesaPhone = null) {
        // Disable button to prevent double submission
        const placeOrderBtn = document.querySelector('.modal-footer .btn-success');
        if (placeOrderBtn) {
          placeOrderBtn.disabled = true;
          placeOrderBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Processing Order...';
        }

        // Show processing toast
        showToast('‚è≥ Processing your order...', 'info');

        // Simulate processing delay
        setTimeout(() => {
          try {          cd c:\Users\Joshua\OneDrive\Desktop\webpr
          npm install
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shippingFee = 50;
            const tax = Math.round(subtotal * 0.005);
            const grandTotal = subtotal + shippingFee + tax;

            const orderData = {
              orderNumber: 'ORD-' + Date.now(),
              customerName: fullName,
              email: email,
              phone: phone,
              mpesaPhone: mpesaPhone || phone,
              address: address,
              city: city,
              paymentMethod: paymentMethod,
              items: cart.slice(), // Create copy of cart
              orderDate: new Date().toLocaleString(),
              status: 'CONFIRMED',
              subtotal: subtotal,
              shipping: shippingFee,
              tax: tax,
              total: grandTotal
            };

            // Save order to localStorage
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push(orderData);
            localStorage.setItem('orders', JSON.stringify(orders));

            // Show success toast
            showToast(`‚úÖ Order ${orderData.orderNumber} confirmed! Redirecting...`, 'success');

            // Show success message in modal area
            const successMessage = document.getElementById('successMessage');
            successMessage.innerHTML = `
              <div class="alert alert-success alert-dismissible fade show" role="alert">
                <div class="mb-3">
                  <h5>‚úì Order Placed Successfully!</h5>
                </div>
                <div class="mb-3">
                  <p class="mb-1"><strong>Order Number:</strong> <span class="text-success fw-bold">${orderData.orderNumber}</span></p>
                  <p class="mb-1"><strong>Total Amount:</strong> <span class="text-success fw-bold">KES ${orderData.total.toLocaleString()}</span></p>
                  <p class="mb-1"><strong>Payment Method:</strong> ${paymentMethod}</p>
                  <p class="mb-0"><strong>Confirmation Email:</strong> Sent to ${email}</p>
                </div>
                <hr>
                <p class="mb-0 text-muted small">You will be redirected to view your order in 3 seconds...</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            `;

            // Clear cart
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
            displayCartItems();
            
            // Close checkout modal
            const checkoutModal = document.getElementById('checkoutModal');
            const bsModal = bootstrap.Modal.getInstance(checkoutModal);
            if (bsModal) {
              bsModal.hide();
            }

            // Reset form
            document.getElementById('checkoutForm').reset();
            
            // Re-enable button
            if (placeOrderBtn) {
              placeOrderBtn.disabled = false;
              placeOrderBtn.innerHTML = 'Place Order';
            }

            // Redirect to orders page after 3 seconds
            setTimeout(() => {
              window.location.href = 'orders.html?neworder=' + orderData.orderNumber;
            }, 3000);

          } catch (error) {
            console.error('Error placing order:', error);
            showToast('‚ùå An error occurred. Please try again.', 'danger');
            if (placeOrderBtn) {
              placeOrderBtn.disabled = false;
              placeOrderBtn.innerHTML = 'Place Order';
            }
          }
        }, 1500);

        return false;
      }
    </script>
</head>
<body>
    <nav class="navbar bg-body-tertiary fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="Index.html">REMEDY STORE</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Welcome</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
          <li class="nav-item">
            <a class="nav-link" href="Index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">About us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="blogs.html">Blogs</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="order.html">Place your order</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="orders.html">My Orders</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contacts.html">Contacts us</a>
          </li>
        </ul>
        <form class="d-flex mt-3" role="search">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
      </div>
    </div>
  </div>
</nav>

<div class="container-fluid mt-5 pt-5">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        <div class="col-md-12">
          <h1 class="mb-4">Place Your Order</h1>
          <p class="lead">Browse our collection of premium natural remedies and wellness products.</p>
        </div>
      </div>

  <div class="row mt-4">
    <!-- Cayenne -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://ke.jumia.is/unsafe/fit-in/500x500/filters:fill(white)/product/74/9156623/1.jpg?1408" class="card-img-top" alt="Cayenne Pepper">
        <div class="card-body">
          <h5 class="card-title">Cayenne Pepper</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Cayenne pepper is rich in capsaicin, a compound that boosts metabolism and improves blood circulation. It helps reduce inflammation, aids digestion, and can help relieve pain. Used traditionally to support heart health and immune function.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Add to meals, smoothies, or take as a supplement capsule.</small></p>
          <p class="text-success"><strong>KES 200</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Cayenne Pepper', 200)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Turmeric -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://media.istockphoto.com/id/1315354434/photo/spoon-of-turmeric-powder.jpg?s=612x612&w=0&k=20&c=aK9DAyX8Jh1bUQuWs_KZ0IL3I73hP8dgHFZXDPzUkRM=" class="card-img-top" alt="Turmeric Powder">
        <div class="card-body">
          <h5 class="card-title">Turmeric Powder</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Turmeric contains curcumin, a powerful anti-inflammatory and antioxidant compound. It supports joint health, reduces inflammation, aids digestion, and may improve brain function. Traditionally used in Ayurvedic medicine for centuries.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Add to curries, golden milk, teas, or take as capsules with black pepper for better absorption.</small></p>
          <p class="text-success"><strong>KES 200</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Turmeric Powder', 200)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Activated Charcoal -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://ke.jumia.is/unsafe/fit-in/680x680/filters:fill(white)/product/32/6139803/1.jpg?2999" class="card-img-top" alt="Activated Charcoal">
        <div class="card-body">
          <h5 class="card-title">Activated Charcoal</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Activated charcoal is known for its detoxifying properties, helping to bind toxins and remove them from the body. It supports digestive health, improves energy levels, and promotes clearer skin. Often used for natural detoxification.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Take as capsules or powder mixed with water. Use for short-term detox or daily wellness.</small></p>
          <p class="text-success"><strong>KES 200</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Activated Charcoal', 200)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Ashwagandha -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://encrypted-tbn2.gstatic.com/shopping?q=tbn:ANd9GcTH8-nNtW3Wwve6YDaDyYZP-O0vC1o6_Z3f-S4WcpHFrsQxtVQFbG7DTVfi1hsGxzmance6ZGLePoBZc2hGfGfdE6kmGRmP6jcXSQGPZVOlRFsX_RfAZB75gQGGlvP9sPhWIwZmtg&usqp=CAc" class="card-img-top" alt="Ashwagandha">
        <div class="card-body">
          <h5 class="card-title">Ashwagandha</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Ashwagandha is an adaptogenic herb that helps reduce stress and anxiety, improves sleep quality, and supports mental clarity. It boosts energy levels, enhances immune function, and may help balance cortisol levels naturally.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Take as capsules, powder mixed in warm milk or smoothies, or as herbal tea.</small></p>
          <p class="text-success"><strong>KES 200</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Ashwagandha', 200)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Flax Seed -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://ke.jumia.is/unsafe/fit-in/680x680/filters:fill(white)/product/96/4305623/1.jpg?2562" class="card-img-top" alt="Flax Seeds">
        <div class="card-body">
          <h5 class="card-title">Flax Seeds</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Flax seeds are rich in omega-3 fatty acids, lignans, and fiber, supporting heart health and reducing inflammation. They aid digestion, promote hormonal balance, support brain function, and provide excellent plant-based protein.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Grind seeds and add to smoothies, cereals, or baked goods. Can also consume whole or make flax milk.</small></p>
          <p class="text-success"><strong>KES 300</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Flax Seeds', 300)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Chia Seeds -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://ke.jumia.is/unsafe/fit-in/500x500/filters:fill(white)/product/22/3685313/1.jpg?5193" class="card-img-top" alt="Chia Seeds">
        <div class="card-body">
          <h5 class="card-title">Chia Seeds</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Chia seeds are superfood packed with omega-3 fatty acids, fiber, and antioxidants. They support digestive health, provide sustained energy, improve hydration, support heart health, and help maintain stable blood sugar levels.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Soak in water or milk for chia pudding, add to smoothies, cereals, or sprinkle on salads.</small></p>
          <p class="text-success"><strong>KES 1,600</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Chia Seeds', 1600)">Add to Cart</button>
        </div>
      </div>
    </div>

    <!-- Stinging Nettle -->
    <div class="col-md-6 mb-5">
      <div class="card h-100">
        <img src="https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcSGFQGFntxIXLcS9ID4NsIoxJeQd8OQpMxXgOQNQSaBi3aV3oUUTKnmUcpA4synNOID_YVsTPmmn10yRlWo0SxNzN7zKaIg82B7TLXvsZibHGYGD0Vd-YhdIPigM7qDO2BKyln-7R_kR90&usqp=CAc" class="card-img-top" alt="Stinging Nettle">
        <div class="card-body">
          <h5 class="card-title">Stinging Nettle</h5>
          <p class="card-text">
            <strong>Benefits:</strong> Stinging nettle is nutrient-dense, rich in vitamins and minerals, supporting joint health and reducing arthritis symptoms. It enhances kidney function, supports hormonal balance, improves circulation, and strengthens immunity naturally.
          </p>
          <p class="text-muted"><small><strong>Usage:</strong> Brew as herbal tea, take as capsules or dried leaf infusions. Best consumed daily for optimal benefits.</small></p>
          <p class="text-success"><strong>KES 300</strong></p>
          <button class="btn btn-success btn-block w-100" onclick="addToCart('Stinging Nettle', 300)">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4 mb-5">
    <div class="col-md-12">
      <h4>Have Questions?</h4>
      <p>Contact us at info@remedystore.com or call +254 715224878</p>
    </div>
  </div>
    </div>

    <!-- Shopping Cart Sidebar -->
    <div class="col-lg-4">
      <div class="card sticky-top" style="top: 80px;">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">üõí Shopping Cart <span class="badge bg-danger ms-2" id="cart-count">0</span></h5>
        </div>
        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
          <div id="cart-items">
            <p class="text-muted">Your cart is empty</p>
          </div>
        </div>
        <div class="card-footer">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <strong>Total:</strong>
            <span id="cart-total" class="text-success fs-5">KES 0</span>
          </div>
          <button class="btn btn-success btn-block w-100 mb-2" onclick="openCheckout()">Checkout</button>
          <button class="btn btn-outline-secondary btn-block w-100" onclick="cart = []; localStorage.setItem('cart', JSON.stringify(cart)); updateCartUI(); displayCartItems();">Clear Cart</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="checkoutModalLabel">Checkout</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="successMessage"></div>
        
        <div class="row">
          <div class="col-md-6">
            <h6 class="mb-3">Delivery Information</h6>
            <form id="checkoutForm">
              <div class="mb-3">
                <label for="fullName" class="form-label">Full Name *</label>
                <input type="text" class="form-control" id="fullName" required>
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Email Address *</label>
                <input type="email" class="form-control" id="email" required>
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">Phone Number *</label>
                <input type="tel" class="form-control" id="phone" placeholder="+254..." required>
              </div>

              <div class="mb-3">
                <label for="address" class="form-label">Street Address *</label>
                <input type="text" class="form-control" id="address" required>
              </div>

              <div class="mb-3">
                <label for="city" class="form-label">City/Town *</label>
                <input type="text" class="form-control" id="city" required>
              </div>

              <h6 class="mb-3 mt-4">Payment Method</h6>
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="mpesa" value="M-Pesa" required checked>
                  <label class="form-check-label" for="mpesa">
                    üì± M-Pesa (Recommended)
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="bank" value="Bank Transfer">
                  <label class="form-check-label" for="bank">
                    üè¶ Bank Transfer
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="Cash on Delivery">
                  <label class="form-check-label" for="cod">
                    üíµ Cash on Delivery
                  </label>
                </div>
              </div>
            </form>
          </div>

          <div class="col-md-6">
            <div id="checkout-summary"></div>
            
            <div class="alert alert-info mt-3">
              <small>
                <strong>Delivery Time:</strong> 2-3 business days<br>
                <strong>Shipping Fee:</strong> KES 50 (Free for orders over KES 1000)<br>
                <strong>Return Policy:</strong> 14 days money-back guarantee
              </small>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success btn-lg" onclick="placeOrder(event)">Place Order</button>
      </div>
    </div>
  </div>
</div>

<!-- M-Pesa Payment Modal -->
<div class="modal fade" id="mpesaPaymentModal" tabindex="-1" aria-labelledby="mpesaPaymentLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="mpesaPaymentLabel">üì± M-Pesa Payment</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <small>
            <strong>Pay to:</strong> 0715224878<br>
            <strong>Service:</strong> Remedy Store Payment<br>
            You will receive an STK prompt on your phone
          </small>
        </div>

        <div class="mb-3">
          <label for="mpesaPhoneInput" class="form-label"><strong>Enter Your M-Pesa Phone Number</strong></label>
          <input type="tel" class="form-control form-control-lg" id="mpesaPhoneInput" placeholder="e.g., 0712345678" required>
          <small class="text-muted">Must be the phone number registered with M-Pesa</small>
        </div>

        <div class="alert alert-secondary">
          <small><strong>Next Steps:</strong></small>
          <ol class="mb-0 ms-2">
            <li>Enter your M-Pesa phone number above</li>
            <li>Click "Send STK" button below</li>
            <li>A popup will appear on your phone with a PIN prompt</li>
            <li>Enter your M-Pesa PIN on your phone when prompted</li>
            <li>Payment will be processed immediately</li>
          </ol>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success btn-lg" onclick="processM2UPayment()">
          <span class="me-2">üì≤</span>Send STK
        </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
